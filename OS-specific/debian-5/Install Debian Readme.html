<h1>WebObjects v5.3 &amp; v5.4 Debian v5 &ldquo;Lenny&rdquo; Installation Recipe</h1>

<h2>Create a new VMware VM</h2>

<ul>
<li>250 GB Hard Disk file (it&rsquo;s sparse, so give us room for log and DB files)</li>
<li>1024 MB RAM (will reduce to 256MB once the auto-partitioner has run)</li>
</ul>


<h2>Install debian-500-i386-netinst.iso</h2>

<ul>
<li>Shutdown, reduce RAM back to 256MB.</li>
</ul>


<p><code>userdel --remove wolf</code></p>

<h2>Install ssh</h2>

<pre><code>apt-get install ssh
</code></pre>

<h2>Install Mercurial</h2>

<pre><code>apt-get install mercurial
cd /etc
hg init
hg addremove
hg ci -m 'initial commit'
</code></pre>

<h2>Add contrib and non-free apt sources (prep for installing Java)</h2>

<pre><code>pico /etc/apt/sources.list
</code></pre>

<p>Add &ldquo;contrib non-free&rdquo; source qualifiers to the file:</p>

<pre style="outline:1px solid lightgray">
    # 
    # deb cdrom:[Debian GNU/Linux 5.0.0 _Lenny_ - Official i386 NETINST Binary-1 20090214-16:03]/ lenny main
    
    #deb cdrom:[Debian GNU/Linux 5.0.0 _Lenny_ - Official i386 NETINST Binary-1 20090214-16:03]/ lenny main
    
    http://debian.uchicago.edu/debian/ lenny main <span style="font-weight:bold;color:green">contrib non-free</span>
    deb-src http://debian.uchicago.edu/debian/ lenny main
    
    deb http://security.debian.org/ lenny/updates main <span style="font-weight:bold;color:green">contrib non-free</span>
    deb-src http://security.debian.org/ lenny/updates main
    
    deb http://volatile.debian.org/debian-volatile lenny/volatile main <span style="font-weight:bold;color:green">contrib non-free</span>
    deb-src http://volatile.debian.org/debian-volatile lenny/volatile main
</pre>


<p>Save your changes, update the source:</p>

<pre><code>apt-get update
cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'Add contrib and non-free apt source qualifiers.'
</code></pre>

<h2>Install Java 5</h2>

<pre><code>apt-get install sun-java5-jre
&lt;agree to prompts&gt;
cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'apt-get install sun-java5-jre'
</code></pre>

<h2>Work-around <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6456628">Sun Bug ID 6456628 &ldquo;Default timezone is incorrectly set occasionally on Linux&rdquo;</a></h2>

<p>This work-around is critical, otherwise WebObjects apps won&rsquo;t start cause they can&rsquo;t parse timezones formatted like &ldquo;<code>SystemV/CST6CDT</code>&rdquo;. <code>NSLog</code>&rsquo;s constructor tries to construct a <code>NSTimezone</code>, which fails. <code>NSTimezone</code> tries to report its failure by constructing an <code>NSLog</code>, leading to an immediate silent abort of the entire process.</p>

<pre><code>mkdir /etc/sysconfig &amp;&amp; echo 'ZONE="America/Chicago"' &gt; /etc/sysconfig/clock
cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'set timezone in /etc/sysconfig/clock'
</code></pre>

<h2>Install WebObjects v5.3.3 and v5.4.3</h2>

<pre><code>wget http://webobjects.mdimension.com/wolips/WOInstaller.jar

mkdir /opt/wo533
mkdir /opt/wo543

java -jar WOInstaller.jar 5.3.3 /opt/wo533
java -jar WOInstaller.jar 5.4.3 /opt/wo543

# Pick a version. We're defaulting to 5.3.3.
ln -s /opt/wo533/Local /opt
ln -s /opt/wo533/Library /opt

rm WOInstaller.jar
</code></pre>

<h2>Add appserver user and appserveradm group</h2>

<pre><code>groupadd appserveradm
useradd -g appserveradm --create-home appserver

chown -R appserver:appserveradm /opt/wo533/Local
chown -R appserver:appserveradm /opt/wo533/Library
chmod 750 /opt/wo533/Library/WebObjects/JavaApplications/JavaMonitor.woa/JavaMonitor
chmod 750 /opt/wo533/Library/WebObjects/JavaApplications/wotaskd.woa/Contents/Resources/SpawnOfWotaskd.sh
chmod 750 /opt/wo533/Library/WebObjects/JavaApplications/wotaskd.woa/wotaskd

chown -R appserver:appserveradm /opt/wo543/Local
chown -R appserver:appserveradm /opt/wo543/Library
chmod 750 /opt/wo543/Library/WebObjects/JavaApplications/JavaMonitor.woa/JavaMonitor
chmod 750 /opt/wo543/Library/WebObjects/JavaApplications/wotaskd.woa/Contents/Resources/SpawnOfWotaskd.sh
chmod 750 /opt/wo543/Library/WebObjects/JavaApplications/wotaskd.woa/wotaskd

su - appserver
echo 'export NEXT_ROOT=/opt' &gt; .bash_profile
exit

cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'useradd appserver &amp;&amp; groupadd appserveradm'
</code></pre>

<h2>Install apache</h2>

<pre><code>apt-get install apache2
cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'apt-get install apache2'
</code></pre>

<h2>Install Adaptor (part 1 of 3)</h2>

<pre><code>WOPLAT=woplat-20090423_debian-5_apache-2.2
cd &amp;&amp; wget http://cloud.github.com/downloads/rentzsch/woplat/$WOPLAT.tgz
</code></pre>

<h2>Either compile the web server adaptor yourself&hellip; (part 2 of 3)</h2>

<pre><code>apt-get install git-core build-essential apache2-threaded-dev
cd &amp;&amp; git clone git://github.com/rentzsch/woplat.git
cd woplat/Adaptors
perl -pi -e 's/ADAPTOR_OS = MACOS/ADAPTOR_OS = LINUX/' make.config
make
apxs2 -i -a -n WebObjects Apache2.2/mod_WebObjects.la
</code></pre>

<h2>&hellip; -or- just install the pre-compiled adaptor binary (part 2 of 3)</h2>

<pre><code>cd &amp;&amp; tar xfz $WOPLAT.tgz
mv $WOPLAT/mod_WebObjects.so /usr/lib/apache2/modules/
</code></pre>

<h2>Install Adaptor (part 3 of 3)</h2>

<pre><code>mv $WOPLAT/apache_webobjects.conf /etc/apache2/apache_webobjects.conf

pico /etc/apache2/sites-enabled/000-default
</code></pre>

<pre style="outline:1px solid lightgray">
    <span style="font-weight:bold;color:green">Include /etc/apache2/apache_webobjects.conf</span>
    
    &lt;VirtualHost *:80>
        ServerAdmin webmaster@localhost
        
        DocumentRoot /var/www/
        &lt;Directory />
            Options FollowSymLinks
            AllowOverride None
        &lt;/Directory>
        
        <span style="font-weight:bold;color:red">ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
        &lt;Directory "/usr/lib/cgi-bin">
            AllowOverride None
            Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
            Order allow,deny
            Allow from all
        &lt;/Directory></span>
        
        &lt;Directory /var/www/>
            Options Indexes FollowSymLinks MultiViews
            AllowOverride None
            Order allow,deny
            allow from all
        &lt;/Directory>
    
        ErrorLog /var/log/apache2/error.log
    
        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn
    
        CustomLog /var/log/apache2/access.log combined
    
        Alias /doc/ "/usr/share/doc/"
        &lt;Directory "/usr/share/doc/">
            Options Indexes MultiViews FollowSymLinks
            AllowOverride None
            Order deny,allow
            Deny from all
            Allow from 127.0.0.0/255.0.0.0 ::1/128
        &lt;/Directory>
    
    &lt;/VirtualHost>
</pre>


<pre><code>apache2ctl configtest
apache2ctl restart

cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'Install apache mod_WebObjects'
</code></pre>

<h1>Install webobjects init.d</h1>

<pre><code>mv ~/$WOPLAT/webobjects.init.d /etc/init.d/webobjects
update-rc.d webobjects defaults
cd /etc &amp;&amp; hg addremove &amp;&amp; hg ci -m 'Install WebObjects init.d'

# You can clean up the folders now.
rm -rf $WOPLAT.tgz $WOPLAT
</code></pre>

<h1>Start WebObjects</h1>

<pre><code>/etc/init.d/webobjects start
</code></pre>